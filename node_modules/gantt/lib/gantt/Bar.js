"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = Bar;

var _h = _interopRequireDefault(require("../h"));

var _utils = require("../utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function Bar(_ref) {
  var styles = _ref.styles,
      data = _ref.data,
      unit = _ref.unit,
      height = _ref.height,
      offsetY = _ref.offsetY,
      minTime = _ref.minTime,
      showDelay = _ref.showDelay,
      rowHeight = _ref.rowHeight,
      barHeight = _ref.barHeight,
      maxTextWidth = _ref.maxTextWidth,
      current = _ref.current,
      onClick = _ref.onClick;
  var x0 = maxTextWidth;
  var y0 = (rowHeight - barHeight) / 2 + offsetY;
  var cur = x0 + (current - minTime) / unit;
  return (0, _h["default"])("g", null, current > minTime ? (0, _h["default"])("line", {
    x1: cur,
    x2: cur,
    y1: offsetY,
    y2: height,
    style: styles.cline
  }) : null, data.map(function (v, i) {
    if (!v.end || !v.start) {
      return null;
    }

    var handler = function handler() {
      return onClick(v);
    };

    var x = x0 + (v.start - minTime) / unit;
    var y = y0 + i * rowHeight;
    var cy = y + barHeight / 2;

    if (v.type === 'milestone') {
      var size = barHeight / 2;
      var points = [[x, cy - size], [x + size, cy], [x, cy + size], [x - size, cy]].map(function (p) {
        return "".concat(p[0], ",").concat(p[1]);
      }).join(' ');
      return (0, _h["default"])("g", {
        key: i,
        "class": "gantt-bar",
        style: {
          cursor: 'pointer'
        },
        onClick: handler
      }, (0, _h["default"])("polygon", {
        points: points,
        style: styles.milestone,
        onClick: handler
      }), (0, _h["default"])("circle", {
        "class": "gantt-ctrl-start",
        "data-id": v.id,
        cx: x,
        cy: cy,
        r: 6,
        style: styles.ctrl
      }));
    }

    var w1 = (v.end - v.start) / unit;
    var w2 = w1 * v.percent;
    var bar = v.type === 'group' ? {
      back: styles.groupBack,
      front: styles.groupFront
    } : {
      back: styles.taskBack,
      front: styles.taskFront
    };

    if (showDelay) {
      if (x + w2 < cur && v.percent < 0.999999) {
        bar.back = styles.warning;
      }

      if (x + w1 < cur && v.percent < 0.999999) {
        bar.back = styles.danger;
      }
    }

    return (0, _h["default"])("g", {
      key: i,
      "class": "gantt-bar",
      style: {
        cursor: 'pointer'
      },
      onClick: handler
    }, (0, _h["default"])("text", {
      x: x - 4,
      y: cy,
      style: styles.text1
    }, (0, _utils.formatDay)(v.start)), (0, _h["default"])("text", {
      x: x + w1 + 4,
      y: cy,
      style: styles.text2
    }, (0, _utils.formatDay)(v.end)), (0, _h["default"])("rect", {
      x: x,
      y: y,
      width: w1,
      height: barHeight,
      rx: 1.8,
      ry: 1.8,
      style: bar.back,
      onClick: handler
    }), w2 > 0.000001 ? (0, _h["default"])("rect", {
      x: x,
      y: y,
      width: w2,
      height: barHeight,
      rx: 1.8,
      ry: 1.8,
      style: bar.front
    }) : null, v.type === 'group' ? null : (0, _h["default"])("g", null, (0, _h["default"])("circle", {
      "class": "gantt-ctrl-start",
      "data-id": v.id,
      cx: x - 12,
      cy: cy,
      r: 6,
      style: styles.ctrl
    }), (0, _h["default"])("circle", {
      "class": "gantt-ctrl-finish",
      "data-id": v.id,
      cx: x + w1 + 12,
      cy: cy,
      r: 6,
      style: styles.ctrl
    })));
  }));
}